---
# ðŸš€ Ù…Ù„Ù Ø¥Ø¹Ø¯Ø§Ø¯ Git Deployment Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù€ cPanel
# Automatic/Push Deployment - ÙŠØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ° ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ git push
# Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† ÙÙŠ Ø§Ù„Ø¬Ø°Ø± (root) Ù„Ù„Ù…Ø³ØªÙˆØ¯Ø¹

deployment:
  tasks:
    # ØªØ­Ø¯ÙŠØ¯ Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª
    # ÙÙŠ cPanelØŒ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ ÙŠÙƒÙˆÙ† Ø¹Ø§Ø¯Ø© ÙÙŠ ~/repositories/repo-name.git
    # ÙˆØ§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù‡Ùˆ working directory Ù„Ù„Ù…Ø³ØªÙˆØ¯Ø¹
    - export DEPLOYPATH=$HOME/public_html
    - export PROJECTPATH=$HOME/whatsapp-clone
    - export REPOPATH=$(pwd)
    
    # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
    - mkdir -p $PROJECTPATH
    
    # Ù†Ø³Ø® Ø¬Ù…ÙŠØ¹ Ù…Ù„ÙØ§Øª Laravel Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø¥Ù„Ù‰ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
    # Ø§Ø³ØªØ«Ù†Ø§Ø¡: node_modules, vendor, .git, storage (Ù„Ø£Ù†Ù‡Ø§ Ù‚Ø¯ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª)
    - /bin/cp -R app bootstrap config database resources routes tests $PROJECTPATH/ 2>/dev/null || true
    - /bin/cp artisan composer.json composer.lock package.json package-lock.json $PROJECTPATH/ 2>/dev/null || true
    - /bin/cp vite.config.ts tsconfig.json tailwind.config.js $PROJECTPATH/ 2>/dev/null || true
    - /bin/cp .htaccess $PROJECTPATH/ 2>/dev/null || true
    
    # Ù†Ø³Ø® Ù…Ø­ØªÙˆÙŠØ§Øª Ù…Ø¬Ù„Ø¯ public Ø¥Ù„Ù‰ public_html
    - /bin/cp -R public/* $DEPLOYPATH/ 2>/dev/null || true
    - /bin/cp public/.htaccess $DEPLOYPATH/ 2>/dev/null || true
    
    # Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
    - cd $PROJECTPATH
    
    # ØªØ«Ø¨ÙŠØª ØªØ¨Ø¹ÙŠØ§Øª Composer (ØªØ­Ø¯ÙŠØ« Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©)
    - composer install --optimize-autoloader --no-dev --no-interaction
    
    # ØªØ«Ø¨ÙŠØª ØªØ¨Ø¹ÙŠØ§Øª npm
    - npm install --production
    
    # Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø£ØµÙˆÙ„ (Assets) Ù…Ù† Vite
    - npm run build
    
    # Ù†Ø³Ø® Ù…Ø¬Ù„Ø¯ build Ù…Ù† public Ø¥Ù„Ù‰ public_html
    - /bin/cp -R public/build $DEPLOYPATH/ 2>/dev/null || true
    
    # Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· storage Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
    - if [ ! -L "$DEPLOYPATH/storage" ]; then cd $DEPLOYPATH && rm -rf storage && ln -s $PROJECTPATH/storage/app/public storage; fi
    
    # ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ù„Ù„Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„Ù…Ù‡Ù…Ø©
    - chmod -R 775 storage
    - chmod -R 775 bootstrap/cache
    
    # ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡ (Cache) - ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ù„Ù .env Ù…ÙˆØ¬ÙˆØ¯
    - if [ -f .env ]; then php artisan config:cache 2>/dev/null || true; fi
    - if [ -f .env ]; then php artisan route:cache 2>/dev/null || true; fi
    - if [ -f .env ]; then php artisan view:cache 2>/dev/null || true; fi
    - if [ -f .env ]; then php artisan event:cache 2>/dev/null || true; fi

